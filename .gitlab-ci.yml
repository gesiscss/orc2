gesis helm lint:
  stage: test
  rules:
    - if: $CI_COMMIT_BRANCH == 'main' || $CI_PIPELINE_SOURCE == 'merge_request_event'
      changes:
        - .gitlab-ci.yml
        - helm/**/*
  image: 
    name: alpine/helm:3.11.1
    entrypoint: [""]
  dependencies: []
  script:
    - helm version
    - helm dependency update ./helm/gesis
    - helm lint ./helm/gesis
    - helm template gesis ./helm/gesis > gesis.helm.chart.yaml
  artifacts:
    paths:
      - gesis.helm.chart.yaml

gesis helm deploy:
  stage: deploy
  image:
    name: bitnami/kubectl:latest
    entrypoint: ['']
  script:
    - kubectl config get-contexts
    - kubectl config use-context ilcm/orc2:kubernetes
    - kubectl get nodes

pages:
  stage: build
  rules:
    - if: $CI_COMMIT_BRANCH == 'main'
      changes:
        - .gitlab-ci.yml
        - docs/**/*
  image: docker-private-snapshots.gesis.intra/gesis/methods-hub/quarto:latest
  dependencies: []
  script:
    - quarto check
    - quarto render docs -t html --output-dir public
    - mv docs/public .
  artifacts:
    paths:
      - public


